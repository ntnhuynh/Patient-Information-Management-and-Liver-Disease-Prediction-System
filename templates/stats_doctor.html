{% extends "layout/base.html" %}

{% block content %}
<div class="stats_doctor-wrapper">
    <h2 class="stats_doctor-title">Th√¥ng tin nh√¢n s·ª± khoa</h2>

    <div id="stats_doctor-data" class="stats_doctor-card">ƒêang t·∫£i d·ªØ li·ªáu...</div>

    <div class="stats_doctor-actions">
        <a href="/create/department" class="stats_doctor-btn stats_doctor-back">
            <i class="fas fa-arrow-left"></i> Quay v·ªÅ
        </a>
    </div>
</div>

<script>
    async function loadStaff() {
        try {
            const pathParts = window.location.pathname.split('/');
            const khoaId = pathParts[pathParts.indexOf('departments') + 1];

            const res = await fetch(`/stats/departments/${khoaId}/staff`);
            const container = document.getElementById("stats_doctor-data");

            if (!res.ok) {
                const errorData = await res.json();
                container.innerHTML = `<p class="stats_doctor-error">‚ùå ${errorData.error || "L·ªói kh√¥ng x√°c ƒë·ªãnh."}</p>`;
                return;
            }

            const data = await res.json();
            let html = `<p><strong>T√™n khoa:</strong> ${data.ten_khoa}</p>`;

            if (data.message) {
                html += `<p><em class="stats_doctor-empty">${data.message}</em></p>`;
                container.innerHTML = html;
                return;
            }

            if (data.truong_khoa) {
                html += `
                    <h3 class="stats_doctor-subtitle">üë®‚Äç‚öïÔ∏è Tr∆∞·ªüng khoa</h3>
                    <div class="stats_doctor-box">
                        <p><strong>H·ªç t√™n:</strong> ${data.truong_khoa.full_name}</p>
                        <p><strong>Email:</strong> ${data.truong_khoa.email}</p>
                        <p><strong>Gi·ªõi t√≠nh:</strong> ${data.truong_khoa.gender}</p>
                        <p><strong>Ng√†y sinh:</strong> ${data.truong_khoa.birth_date || "Ch∆∞a c·∫≠p nh·∫≠t"}</p>
                    </div>
                `;
            } else {
                html += `<p><em class="stats_doctor-empty">Ch∆∞a c√≥ tr∆∞·ªüng khoa.</em></p>`;
            }

            if (Array.isArray(data.bac_si) && data.bac_si.length > 0) {
                html += `<h3 class="stats_doctor-subtitle">ü©∫ Danh s√°ch b√°c sƒ©</h3>`;
                data.bac_si.forEach(bs => {
                    html += `
                        <div class="stats_doctor-box">
                            <p><strong>H·ªç t√™n:</strong> ${bs.full_name}</p>
                            <p><strong>Email:</strong> ${bs.email}</p>
                            <p><strong>Gi·ªõi t√≠nh:</strong> ${bs.gender}</p>
                            <p><strong>Ng√†y sinh:</strong> ${bs.birth_date || "Ch∆∞a c·∫≠p nh·∫≠t"}</p>
                        </div>
                    `;
                });
            } else {
                html += `<p><em class="stats_doctor-empty">Kh√¥ng c√≥ b√°c sƒ© n√†o trong khoa n√†y.</em></p>`;
            }

            container.innerHTML = html;
        } catch (err) {
            document.getElementById("stats_doctor-data").innerHTML = `<p class="stats_doctor-error">‚ö†Ô∏è L·ªói khi t·∫£i d·ªØ li·ªáu.</p>`;
            console.error("L·ªói:", err);
        }
    }

    loadStaff();
</script>
{% endblock %}